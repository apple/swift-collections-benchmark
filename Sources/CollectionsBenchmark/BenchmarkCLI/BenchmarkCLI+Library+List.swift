//===----------------------------------------------------------------------===//
//
// This source file is part of the Swift Collections open source project
//
// Copyright (c) 2021 Apple Inc. and the Swift project authors
// Licensed under Apache License v2.0 with Runtime Library Exception
//
// See https://swift.org/LICENSE.txt for license information
//
//===----------------------------------------------------------------------===//

import ArgumentParser
import SystemPackage

extension _BenchmarkCLI.Library {
  internal struct List: _BenchmarkCommand {
    static var configuration: CommandConfiguration {
      CommandConfiguration(
        commandName: "list",
        abstract: "List the contents of a library configuration file.")
    }

    @Option(
      help: "Path to a library configuration file in JSON format.",
      completion: .file(extensions: ["json"]),
      transform: { str in FilePath(str) })
    var library: FilePath

    @Flag(help: "List all tasks included in the library.")
    var tasks = false

    @Flag(help: "List image files generated by the library.")
    var images = false

    @Option(help: "The image format to use with '--images' (default: \(ImageFormat.defaultSinglefile.rawValue)")
    var format: ImageFormat = .defaultSinglefile

    func run(benchmark: Benchmark) throws {
      let library = try benchmark._loadLibrary(self.library)

      if images {
        library.allImages(format: format).forEach { print($0) }
      } else if tasks {
        library.allTasks.forEach { print($0) }
      } else {
        throw Benchmark.Error("Please specify one of --tasks or --images")
      }
    }
  }
}
